<!DOCTYPE html>
<html>

<head>
  <title>Tạo dữ liệu mẫu</title>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      max-width: 800px;
      margin: 0 auto;
    }

    #log p {
      margin: 5px 0;
    }
  </style>
</head>

<body>
  <h1>Đang tạo dữ liệu mẫu...</h1>
  <div id="log"></div>

  <script>
    const API_BASE = 'https://web-blockchain-production.up.railway.app/api';
    const log = document.getElementById('log');

    async function createSampleData() {
      try {
        // Tạo 3 lô
        const batches = [
          { batch_code: 'BC001', product_name: 'Nang hoa 9', quantity: 2500, unit: 'kg', created_by: 'admin' },
          { batch_code: 'BC002', product_name: 'ST25', quantity: 3000, unit: 'kg', created_by: 'admin' },
          { batch_code: 'BC003', product_name: 'Jasmine 85', quantity: 1500, unit: 'kg', created_by: 'admin' }
        ];

        for (const batch of batches) {
          const res = await fetch(`${API_BASE}/batches/simple`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(batch)
          });
          const data = await res.json();
          log.innerHTML += `<p>✅ Đã tạo lô ${batch.batch_code} - ${batch.product_name}</p>`;
          console.log(data);
        }

        // Thêm nhiều sự kiện cho mỗi lô
        const events = [
          // BC001 - Nang hoa 9
          { batch_code: 'BC001', action: 'Gieo trong', description: 'Gieo giong Nang hoa 9 tai ruong', location: 'Xa Tan Phu, Huyen Vinh Cuu, Tinh Dong Nai' },
          { batch_code: 'BC001', action: 'Cham soc', description: 'Bon phan lan 1 - NPK 16-16-8', location: 'Xa Tan Phu, Huyen Vinh Cuu, Tinh Dong Nai' },
          { batch_code: 'BC001', action: 'Cham soc', description: 'Phun thuoc tru sau benh', location: 'Xa Tan Phu, Huyen Vinh Cuu, Tinh Dong Nai' },
          { batch_code: 'BC001', action: 'Thu hoach', description: 'Thu hoach lua - do am 14%', location: 'Xa Tan Phu, Huyen Vinh Cuu, Tinh Dong Nai' },
          { batch_code: 'BC001', action: 'Van chuyen', description: 'Van chuyen ve nha may xay xat', location: 'Nha may ABC - Dong Nai' },

          // BC002 - ST25
          { batch_code: 'BC002', action: 'Gieo trong', description: 'Gieo giong ST25 cao cap', location: 'Dong Thap, Viet Nam' },
          { batch_code: 'BC002', action: 'Cham soc', description: 'Bon phan huu co', location: 'Dong Thap, Viet Nam' },
          { batch_code: 'BC002', action: 'Cham soc', description: 'Kiem soat dich hai', location: 'Dong Thap, Viet Nam' },
          { batch_code: 'BC002', action: 'Thu hoach', description: 'Thu hoach lua ST25', location: 'Dong Thap, Viet Nam' },

          // BC003 - Jasmine 85
          { batch_code: 'BC003', action: 'Gieo trong', description: 'Gieo giong Jasmine 85', location: 'An Giang, Viet Nam' },
          { batch_code: 'BC003', action: 'Cham soc', description: 'Tuoi nuoc va bon phan', location: 'An Giang, Viet Nam' },
          { batch_code: 'BC003', action: 'Thu hoach', description: 'Thu hoach lua Jasmine', location: 'An Giang, Viet Nam' }
        ];

        for (const event of events) {
          const res = await fetch(`${API_BASE}/batches/${event.batch_code}/transaction/simple`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
              action: event.action,
              description: event.description,
              location: event.location
            })
          });
          const data = await res.json();
          log.innerHTML += `<p>✅ Đã thêm sự kiện "${event.action}" cho ${event.batch_code}</p>`;
          console.log(data);

          // Đợi 200ms giữa các request để tránh quá tải
          await new Promise(resolve => setTimeout(resolve, 200));
        }

        log.innerHTML += '<h2 style="color: green;">✅ Hoàn tất!</h2>';
        log.innerHTML += '<p><strong>Đã tạo 3 lô mẫu:</strong></p>';
        log.innerHTML += '<ul><li>BC001 - Nang hoa 9 (5 sự kiện)</li><li>BC002 - ST25 (4 sự kiện)</li><li>BC003 - Jasmine 85 (3 sự kiện)</li></ul>';
        log.innerHTML += '<p><a href="traceability.html" style="display: inline-block; padding: 10px 20px; background: #28a745; color: white; text-decoration: none; border-radius: 5px; margin-top: 10px;">Đi đến trang truy xuất</a></p>';

      } catch (err) {
        log.innerHTML += `<p style="color: red;">❌ Lỗi: ${err.message}</p>`;
        console.error(err);
      }
    }

    createSampleData();
  </script>
</body>

</html>